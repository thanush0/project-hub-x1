# Contributing: CMS + CI + Free Deploy Workflow (No Front‑End Code Changes)

This document explains how content editors and developers can work with the Git‑based CMS (Decap/Netlify CMS), automatic content sync (GitHub Actions), and free hosting (Render) without modifying the front‑end source code of `project-hub-x`.

## Overview
- CMS (Decap/Netlify CMS) lives in `cms-admin/` and writes content files to `content/`.
- A generator script converts `content/` into `project-hub-x/src/data/mockData.ts` that the app already uses.
- GitHub Actions runs on push to `main` and updates `mockData.ts` automatically.
- The front‑end is deployed for free on Render using `render.yaml`.

## Repository Structure (relevant parts)
```
content/                                # Git-based content (managed by CMS)
  faq/
  clienttestimonials/
  howitworkssteps/
  readymadeprojects/

cms-admin/                              # Decap CMS admin UI (host on Netlify)
  config.yml                            # Uses git-gateway backend
  index.html
  NETLIFY_SETUP.txt

project-hub-x/                          # Front-end Astro + React app
  src/data/mockData.ts                  # Generated by the generator script

.github/workflows/content-sync.yml      # CI to regenerate mockData.ts on push
render.yaml                             # Render free web service config

tools/generate-mockdata-from-content.mjs# Generator: content -> mockData.ts
package.json                            # Automation scripts at repo root
```

## Roles
- Content Editors: Use the CMS UI hosted on Netlify to add/edit content. No code knowledge needed.
- Developers: Review PRs, maintain generator and CI, handle deployments.

---

## 1) CMS (Netlify + Identity + Git Gateway)
See `cms-admin/NETLIFY_SETUP.txt` for full steps. Summary:
1. Create a Netlify site from the `cms-admin` folder of this repo:
   - Base directory: `cms-admin`
   - Build command: none (static)
   - Publish directory: `cms-admin`
2. Enable Netlify Identity (Site Settings → Identity → Enable Identity).
3. Enable Git Gateway (Identity → Services → Enable Git Gateway) and authorize access to this GitHub repo.
4. Ensure `cms-admin/config.yml` contains:
   ```yml
   backend:
     name: git-gateway
     branch: main
   media_folder: "content/media"
   public_folder: "/content/media"
   ```
5. Log into the CMS via `<yoursite>.netlify.app/index.html` and start editing content. Changes will be committed to `content/` in this repo.

---

## 2) Automatic Content Sync (GitHub Actions)
- Workflow file: `.github/workflows/content-sync.yml`.
- Triggered on:
  - pushes to `main` that modify `content/**`, `cms-admin/**`, or the generator script.
  - manual dispatch.
- Steps:
  1) Install root tooling.
  2) Run the generator `tools/generate-mockdata-from-content.mjs`.
  3) If `project-hub-x/src/data/mockData.ts` changed, commit & push the update back to `main`.

No changes to front‑end code are required; only the generated `mockData.ts` is updated.

---

## 3) Front‑End Deployment (Render, Free)
We ship `render.yaml` for a one‑click setup.

- Service type: Web (Node), free plan
- Build command:
  ```bash
  npm install
  npm --prefix project-hub-x install
  node tools/generate-mockdata-from-content.mjs || echo "Generator skipped"
  ```
- Start command:
  ```bash
  npx --yes astro@latest dev --root project-hub-x --port $PORT --host
  ```
- Health Check Path: `/`
- Env Var: `NODE_VERSION=18`

Notes:
- Using `astro dev` runs an SSR dev server suitable for free hosting with sleep/wake behavior. For a production build, you would add an Astro adapter (but that would change front‑end config). This setup honors the "no changes to front‑end source code" requirement.

---

## 4) Local Development (Optional)
From repo root:
```bash
# one-time
npm run setup

# run CMS backend, serve CMS UI, watch content, regenerate data, and run the web app
npm run dev
```
- CMS UI: http://localhost:5500
- Web app: http://localhost:4321

If you prefer just the app:
```bash
npm --prefix project-hub-x run dev
```

---

## 5) Branching, PRs, and Releases
- Branch from `main`: `feature/cms-<topic>` or `chore/content-update-<date>`
- After content edits via CMS (which commit to `content/`), CI will push updated `mockData.ts` to `main` automatically. For content-only changes, no PR is necessary.
- For generator or workflow changes, open a PR to `main`.

Suggested PR template:
```
## Summary
- What changed and why

## Changes
- [ ] Content updated in `content/`
- [ ] Generator updated
- [ ] Workflow updated
- [ ] Deployment settings

## Testing
- [ ] Local: `node tools/generate-mockdata-from-content.mjs`
- [ ] App: `npm --prefix project-hub-x run dev` (http://localhost:4321)

## Notes
- No front-end source code changes
```

---

## 6) Troubleshooting
- CMS cannot save
  - Check Netlify Identity and Git Gateway are enabled.
  - Ensure the CMS site has access to the GitHub repo.
- GitHub Action didn’t run
  - Verify the push was to `main` and paths matched `content/**`.
  - Manually trigger the workflow via the Actions tab.
- App didn’t update after CMS edit
  - Confirm the CI ran and updated `project-hub-x/src/data/mockData.ts`.
  - Ensure your deployment provider is set to redeploy on push to `main`.
- Local generator errors
  - Install dependencies at repo root: `npm install`
  - Run: `node tools/generate-mockdata-from-content.mjs`

---

## 7) Security & Access
- Keep CMS write access restricted using Netlify Identity (invite only) and Git Gateway.
- Protect `main` with branch protection rules as needed.

---

## 8) Summary
- Editors update content via CMS → files land in `content/`.
- GitHub Action auto‑generates `mockData.ts` → app uses it as usual.
- Front‑end deploys on Render for free, without changing the app’s code.
