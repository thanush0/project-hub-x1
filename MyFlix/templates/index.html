{% extends "base.html" %}

{% block title %}MyFlix - Home{% endblock %}
{% block nav_home %}active{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-content">
        <h1 class="hero-title">Welcome to MyFlix</h1>
        <p class="hero-subtitle">Your personal streaming platform powered by Telegram</p>
        <div class="hero-stats">
            <span class="stat-item">üé¨ {{ total_movies }} Movies</span>
            <span class="stat-item">üìÇ {{ genre_groups|length }} Categories</span>
        </div>
    </div>
    <div class="hero-gradient"></div>
</section>

<!-- Movies by Genre -->
<div class="container">
    {% if movies %}
        {% for genre, genre_movies in genre_groups.items() %}
        <section class="movie-row" data-genre="{{ genre }}">
            <div class="row-header">
                <h2 class="row-title">{{ genre }}</h2>
                <a href="/category/{{ genre }}" class="view-all">View All ‚Üí</a>
            </div>
            
            <div class="movie-grid">
                {% for movie in genre_movies[:6] %}
                <div class="movie-card" data-movie-id="{{ movie.message_id }}">
                    <a href="/watch/{{ movie.message_id }}">
                        <div class="movie-poster">
                            {% if movie.thumbnail %}
                            <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 450'><rect fill='%23141414' width='300' height='450'/><text x='50%' y='50%' fill='%23e50914' font-size='60' text-anchor='middle' dominant-baseline='middle'>üé¨</text></svg>" 
                                 alt="{{ movie.title }}" 
                                 loading="lazy">
                            {% else %}
                            <div class="poster-placeholder">
                                <span class="poster-icon">üé¨</span>
                                <span class="poster-text">{{ movie.title }}</span>
                            </div>
                            {% endif %}
                            
                            <div class="movie-overlay">
                                <div class="overlay-content">
                                    <button class="play-button">‚ñ∂</button>
                                    <h3 class="movie-title">{{ movie.title }}</h3>
                                    <div class="movie-meta">
                                        <span class="meta-item">‚≠ê {{ movie.rating }}</span>
                                        <span class="meta-item">üïê {{ movie.duration_formatted }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                    
                    <div class="movie-info">
                        <h3 class="movie-title-small">{{ movie.title }}</h3>
                        <p class="movie-year">{{ movie.year }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endfor %}
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">üé¨</div>
        <h2>No Movies Available</h2>
        <p>Upload some videos to your Telegram channel to get started!</p>
        <p class="empty-help">
            Make sure your bot is added to the channel and has access to messages.
        </p>
        <button onclick="refreshCache()" class="btn-refresh">Refresh Cache</button>
    </div>
    {% endif %}
</div>

<!-- Loading Indicator -->
<div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="spinner"></div>
    <p>Loading...</p>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Smooth scroll for movie rows
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects
    const movieCards = document.querySelectorAll('.movie-card');
    movieCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.05)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    });
    
    // Update movie count in footer
    const movieCount = {{ total_movies }};
    const movieCountElement = document.getElementById('movieCount');
    if (movieCountElement) {
        movieCountElement.textContent = `${movieCount} movies available`;
    }
});

// Lazy loading for movie posters
if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                // Load actual thumbnail here if implementing thumbnail API
                observer.unobserve(img);
            }
        });
    });
    
    document.querySelectorAll('.movie-poster img').forEach(img => {
        imageObserver.observe(img);
    });
}
</script>
{% endblock %}
